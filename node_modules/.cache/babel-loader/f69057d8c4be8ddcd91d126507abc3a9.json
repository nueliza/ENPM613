{"ast":null,"code":"// Based on https://github.com/dscape/cycle/blob/master/cycle.js\nmodule.exports = function decycle(object) {\n  // Make a deep copy of an object or array, assuring that there is at most\n  // one instance of each object or array in the resulting structure. The\n  // duplicate references (which might be forming cycles) are replaced with\n  // an object of the form\n  //      {$ref: PATH}\n  // where the PATH is a JSONPath string that locates the first occurance.\n  // So,\n  //      var a = [];\n  //      a[0] = a;\n  //      return JSON.stringify(JSON.decycle(a));\n  // produces the string '[{\"$ref\":\"$\"}]'.\n  // JSONPath is used to locate the unique object. $ indicates the top level of\n  // the object or array. [NUMBER] or [STRING] indicates a child member or\n  // property.\n  var objects = [],\n      // Keep a reference to each unique object or array\n  paths = []; // Keep the path to each unique object or array\n\n  return function derez(value, path) {\n    // The derez recurses through the object, producing the deep copy.\n    var i, // The loop counter\n    name, // Property name\n    nu; // The new object or array\n    // typeof null === 'object', so go on if this value is really an object but not\n    // one of the weird builtin objects.\n\n    if (typeof value === 'object' && value !== null && !(value instanceof Boolean) && !(value instanceof Date) && !(value instanceof Number) && !(value instanceof RegExp) && !(value instanceof String)) {\n      // If the value is an object or array, look to see if we have already\n      // encountered it. If so, return a $ref/path object. This is a hard way,\n      // linear search that will get slower as the number of unique objects grows.\n      for (i = 0; i < objects.length; i += 1) {\n        if (objects[i] === value) {\n          return {\n            $ref: paths[i]\n          };\n        }\n      } // Otherwise, accumulate the unique value and its path.\n\n\n      objects.push(value);\n      paths.push(path); // If it is an array, replicate the array.\n\n      if (Object.prototype.toString.apply(value) === '[object Array]') {\n        nu = [];\n\n        for (i = 0; i < value.length; i += 1) {\n          nu[i] = derez(value[i], path + '[' + i + ']');\n        }\n      } else {\n        // If it is an object, replicate the object.\n        nu = {};\n\n        for (name in value) {\n          if (Object.prototype.hasOwnProperty.call(value, name)) {\n            nu[name] = derez(value[name], path + '[' + JSON.stringify(name) + ']');\n          }\n        }\n      }\n\n      return nu;\n    }\n\n    return value;\n  }(object, '$');\n};","map":null,"metadata":{},"sourceType":"script"}